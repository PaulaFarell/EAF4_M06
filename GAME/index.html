<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Pixel Climber</title>
    <!-- <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script> -->
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/phaser@v3.80.1/dist/phaser.js"></script>
</head>
<body>
    
    
    
    <script type="text/javascript">
        
    </script>
    
</body>
<script type="module">
    import Loader from './js/helpers/Loader.js';

    class Main extends Phaser.Scene
    {
        constructor() {
            super("SceneMain");
        }
        preload() {
        
            //Cargador
            //Loader(this);
        	this.load.image('Terrain', 'img/Terrain_16_x_16.png')
            this.load.image('Background','img/Complete_static_BG_288_x_208.png')
            this.load.tilemapTiledJSON('tilemap','json/Level1.json')
            
            this.load.spritesheet('player_derecha','img/Michi_derecha.png',{ frameWidth: 22, frameHeight:16 })
            this.load.spritesheet('player','img/Michi_frente.png',{ frameWidth: 22, frameHeight:16 })
            this.load.spritesheet('player_izquierda','img/Michi_izquierda.png',{ frameWidth: 22, frameHeight:16 })
        }
        
        create() {

            this.map = this.make.tilemap( 
                {
                    "draworder":"topdown",
                    "id":3,
                    "name":"Terrain",
                    "objects":[
                           {
                            "height":16,
                            "id":2,
                            "name":"",
                            "rotation":0,
                            "type":"",
                            "visible":true,
                            "width":800,
                            "x":0,
                            "y":192
                           }, 
                           {
                            "height":32,
                            "id":3,
                            "name":"",
                            "rotation":0,
                            "type":"",
                            "visible":true,
                            "width":176,
                            "x":96,
                            "y":176
                           }, 
                           {
                            "height":48,
                            "id":4,
                            "name":"",
                            "rotation":0,
                            "type":"",
                            "visible":true,
                            "width":80,
                            "x":144,
                            "y":160
                           }, 
                           {
                            "height":16,
                            "id":5,
                            "name":"",
                            "rotation":0,
                            "type":"",
                            "visible":true,
                            "width":80,
                            "x":144,
                            "y":96
                           }, 
                           {
                            "height":16,
                            "id":6,
                            "name":"",
                            "rotation":0,
                            "type":"",
                            "visible":true,
                            "width":64,
                            "x":272,
                            "y":64
                           }, 
                           {
                            "height":32,
                            "id":7,
                            "name":"",
                            "rotation":0,
                            "type":"",
                            "visible":true,
                            "width":48,
                            "x":400,
                            "y":112
                           }, 
                           {
                            "height":16,
                            "id":8,
                            "name":"",
                            "rotation":0,
                            "type":"",
                            "visible":true,
                            "width":64,
                            "x":512,
                            "y":80
                           }, 
                           {
                            "height":48,
                            "id":9,
                            "name":"",
                            "rotation":0,
                            "type":"",
                            "visible":true,
                            "width":112,
                            "x":624,
                            "y":160
                           }, 
                           {
                            "height":64,
                            "id":10,
                            "name":"",
                            "rotation":0,
                            "type":"",
                            "visible":true,
                            "width":48,
                            "x":656,
                            "y":144
                           }],
                    "opacity":1,
                    "type":"objectgroup",
                    "visible":true,
                    "x":0,
                    "y":0
                   }
               );
            this.tileset = this.map.addTilesetImage('Layer','Terrain',16,16);
            this.layer = this.map.createLayer('Terrain', this.tileset);
            //this.cameras.main.setBounds(0, 0,this.map.widthInPixels, this.map.heightInPixels);

            //this.map.setCollision([ 20, 48 ]);
            
            // Crear el jugador
            this.player = this.physics.add.sprite(0, 450, 'player');
            this.player.setBounce(0.2);
            this.player.setCollideWorldBounds(true);
            this.player.setScale(2);
                    
            
            this.anims.create({
                key: 'right',
                frames: this.anims.generateFrameNumbers('player_derecha',{ frames: [ 0, 1, 2, 3 ] }),
                frameRate: 12,
                repeat: -1
            });
            this.anims.create({
                key: 'left',
                frames: this.anims.generateFrameNumbers('player_izquierda',{ frames: [ 0, 1, 2, 3 ] }),
                frameRate: 12,
                repeat: -1
            });
        
            // Configurar colÂ·lisions
            //this.physics.add.collider(player, platforms);
        
            this.cursors = this.input.keyboard.createCursorKeys();

        }
        
        update() {

            if (this.cursors.left.isDown) {
                this.player.setVelocityX(-160);
                this.player.anims.play('left', true);
            } else if (this.cursors.right.isDown) {
                this.player.setVelocityX(160);
                this.player.anims.play('right', true);
            } else {
                this.player.setVelocityX(0);
                this.player.anims.stop()
            }
            
            if ((this.cursors.space.isDown || this.cursors.up.isDown) && this.player.body.onFloor())
            {
                this.player.body.setVelocityY(-300);
            }
        }
    }



    var config = {
        pixelArt: true,
        type: Phaser.AUTO,
        scale:{
            mode: Phaser.Scale.FIT,
            parent: 'phaser-example',
            autoCenter: Phaser.Scale.CENTER_BOTH,
            width: 800,
            height: 600
        },
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 300 },
                debug: false
            }
        },
        scene: Main
    };
    
    var game = new Phaser.Game(config);
    
</script>
</html>
